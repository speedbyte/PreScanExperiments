function recognition_templates
% From sign images inside chosen folders, the function creates 
% recognition_templates.mat file, which is used in recognition process.

N = 55;	% No of signs to recognize
no = 0;
RecognitionTemplates = struct([]);

no = no + 1;
RecognitionTemplates(no).name  = 'z101';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z102';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z103-10';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z103-20';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z105-10';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z105-20';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z112';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z113';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z114';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z116';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z120';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z121-10';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z121-20';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z123';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z124';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z131';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z133-10';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z134-10';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z136-10';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z136-20';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z138-10';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z205';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 2;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z206';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 3;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z208';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name = 'z250';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z267';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 4;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z272';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 5;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name = 'z274-52';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 20;

no = no + 1;
RecognitionTemplates(no).name = 'z274-52_MatrixSign';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no-1;
RecognitionTemplates(no).SpeedLimit = 20;

no = no + 1;
RecognitionTemplates(no).name = 'z274-53';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 30;

no = no + 1;
RecognitionTemplates(no).name = 'z274-53_MatrixSign';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no-1;
RecognitionTemplates(no).SpeedLimit = 30;

no = no + 1;
RecognitionTemplates(no).name = 'z274-54';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 40;

no = no + 1;
RecognitionTemplates(no).name = 'z274-54_MatrixSign';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no-1;
RecognitionTemplates(no).SpeedLimit = 40;

no = no + 1;
RecognitionTemplates(no).name = 'z274-55';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 50;

no = no + 1;
RecognitionTemplates(no).name = 'z274-55_MatrixSign';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no-1;
RecognitionTemplates(no).SpeedLimit = 50;

no = no + 1;
RecognitionTemplates(no).name = 'z274-56';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 60;

no = no + 1;
RecognitionTemplates(no).name = 'z274-56_MatrixSign';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no-1;
RecognitionTemplates(no).SpeedLimit = 60;

no = no + 1;
RecognitionTemplates(no).name = 'z274-57';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 70;

no = no + 1;
RecognitionTemplates(no).name = 'z274-57_MatrixSign';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no-1;
RecognitionTemplates(no).SpeedLimit = 70;

no = no + 1;
RecognitionTemplates(no).name = 'z274-58';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 80;

no = no + 1;
RecognitionTemplates(no).name = 'z274-58_MatrixSign';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no-1;
RecognitionTemplates(no).SpeedLimit = 80;

no = no + 1;
RecognitionTemplates(no).name = 'z274-59';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 90;

no = no + 1;
RecognitionTemplates(no).name = 'z274-59_MatrixSign';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no-1;
RecognitionTemplates(no).SpeedLimit = 90;

no = no + 1;
RecognitionTemplates(no).name = 'z274-60';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 100;

no = no + 1;
RecognitionTemplates(no).name = 'z274-60_MatrixSign';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no-1;
RecognitionTemplates(no).SpeedLimit = 100;

no = no + 1;
RecognitionTemplates(no).name = 'z274-61';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 110;

no = no + 1;
RecognitionTemplates(no).name = 'z274-61_MatrixSign';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no-1;
RecognitionTemplates(no).SpeedLimit = 110;

no = no + 1;
RecognitionTemplates(no).name = 'z274-62';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 120;

no = no + 1;
RecognitionTemplates(no).name = 'z274-62_MatrixSign';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no-1;
RecognitionTemplates(no).SpeedLimit = 120;

no = no + 1;
RecognitionTemplates(no).name = 'z274-63';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 130;

no = no + 1;
RecognitionTemplates(no).name = 'z274-63_MatrixSign';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no-1;
RecognitionTemplates(no).SpeedLimit = 130;

no = no + 1;
RecognitionTemplates(no).name = 'z276';
RecognitionTemplates(no).ext  = 'png';
RecognitionTemplates(no).dir  = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 6;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z301';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z302';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

no = no + 1;
RecognitionTemplates(no).name  = 'z303';
RecognitionTemplates(no).ext   = 'png';
RecognitionTemplates(no).dir   = 'TSR_recognition_templates';
RecognitionTemplates(no).detID = 1;
RecognitionTemplates(no).recID = no;
RecognitionTemplates(no).SpeedLimit = 0;

%% Generate recognition templates
for ii = 1 : N
    [RecognitionTemplates(ii).img, RecognitionTemplates(ii).imgRGB, RecognitionTemplates(ii).RGBnn, RecognitionTemplates(ii).RGBmm, RecognitionTemplates(ii).GUIy] = ...
        recognition_template_gen(RecognitionTemplates(ii).dir, RecognitionTemplates(ii).ext, RecognitionTemplates(ii).name);
end

save('..\includes_TSR\RecognitionTemplates.mat', 'RecognitionTemplates');     %#ok<*NASGU>

end

%%
function [im_y, im_rgb_out, RGBnn, RGBmm, im_GUIy] = recognition_template_gen(im_dir, im_ext, im_name)
% Prepares a template from a file

% Read the file
im_rgb = imread(strcat('../includes_TSR/',im_dir,'/',im_name,'.',im_ext),im_ext);
im_r = im_rgb(:,:,1);
im_g = im_rgb(:,:,2);
im_b = im_rgb(:,:,3);

% Convert image
hcsc1 = video.ColorSpaceConverter;
hcsc1.Conversion = 'RGB to YCbCr';
im_ycbcr = step(hcsc1, im_rgb);
im_y  = im_ycbcr(:,:,1);
im_cr = im_ycbcr(:,:,3);

hcsc2 = video.ColorSpaceConverter;
hcsc2.Conversion = 'RGB to intensity';
im_int = step(hcsc2, im_rgb);

% Normalization
im_y   = (double(im_y  ) - 16) / 219;
im_cr  = (double(im_cr ) - 16) / 224;
im_int =  double(im_int)       / 255;
im_y_GUI = im_y;

% Convert to binary
im_CrBin = im_cr > 0.55;

% Imfill
im_CrBin_GUI = imfill(im_CrBin, 'holes');

% Background ( [240 240 240] - GUI background colour)
im_y(~imfill(imclearborder(~im_CrBin),'holes')) = 0;
im_y_GUI(~im_CrBin_GUI(:,:)) = 0;
im_r(~im_CrBin_GUI) = 240;
im_g(~im_CrBin_GUI) = 240;
im_b(~im_CrBin_GUI) = 240;

% Resize image to accurate sign size
[ner, nec] = cutimage(bwareaopen(logical(im_y),10));
%[ner, nec] = cutimage(logical(im_y));
im_y = im_y(ner, nec);

%[ner_GUI, nec_GUI] = cutimage(bwareaopen(logical(im_y_GUI),10));
[ner_GUI, nec_GUI] = cutimage(logical(im_y_GUI));
im_r = im_r(ner_GUI, nec_GUI);
im_g = im_g(ner_GUI, nec_GUI);
im_b = im_b(ner_GUI, nec_GUI);

im_rgb_out(:,:,1) = im_r(:,:,1);
im_rgb_out(:,:,2) = im_g;
im_rgb_out(:,:,3) = im_b;

% Resize for GUI
%im_rgb_out = imresize(im_rgb_out, [NaN 100], 'bilinear');
im_rgb_out = imresize(im_rgb_out, [100 NaN], 'bilinear');
[RGBnn, RGBmm, ~] = size(im_rgb_out);

% Prepare gray image for GUI
hcsc3 = video.ColorSpaceConverter;
hcsc3.Conversion = 'RGB to intensity';
im_GUIy = step(hcsc3, im_rgb_out);

end
